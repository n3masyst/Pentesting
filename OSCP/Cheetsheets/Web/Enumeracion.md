


## NMAP

````
# Detección de versón
nmap -Pn -sV -p $port "--script=banner" $ip
nmap -Pn -sV -p $port "--script=http-vuln" $ip
nmap -Pn -sV -p $port "--script=http-enum" $ip
````

## Enumeracion de recursos web

En esta seccion trataremos todo lo referente a la exploracion de la logica y infraestructura web, buscamos enumerar el mayor numero de directorios, subdominio y archivos para definir correctamente nuestra superficie de ataque.

Buenas practicas a desarrollar para nuestra metodologia:
1. Usar varias herramientas de enumeracion para validar resultados y evitar falsos positivos. (en ocasiones fuzzear con la misma wordlist y con distintas herramientas obtendremos resultados diferentes)
2. Repetir la enumeracion si accedemos a algun directorio principal o de un tamaño considerable de la web.
3. Enumerar primero la webroot. (Puede que la web no este montada en la propia raiz si no en un directorio dentro de la misma)
4. Considerar nombres de bases de datos enumeradas en otros servicios como posibles directorios.

* gobuster
````
gobuster dir -u $url -w /usr/share/seclists/Discovery/Web-Content/common.txt -x "txt,html,php,asp,aspx,jsp" -s "200,204,301,302,307,403,500" -k -t 16

# Fuzzing a traves de un proxy
gobuster dir -p socks5://127.0.0.1:1080 -u http://10.10.10.10 -w common.txt
````

* dirsearch
````
python3 /opt/dirsearch/dirsearch.py -u $url -t 16 -e txt,html,php,asp,aspx,jsp -f -x 403 -w /usr/share/seclists/Discovery/Web-Content/common.txt 
````

* wfuzz
````bash

wfuzz -c -z -w /usr/share/seclists/Discovery/Web-Content/common.txt --hc 404 -t 16 $url/FUZZ 2>&1

# Enumeracion de subdominios
wfuzz -c --hc=404 -t 200 -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H "Host: FUZZ.domain.com" http://10.10.10.x

# Fuzzing con extensiones de archivos
wfuzz -c --hc=404 -w /usr/share/wordlist/dirbuster/directory-list-2.3-medium.txt "https://domain.com/FUZZ.php"
wfuzz -c --hc=404 -w /Seclist/Discovery/Web-Content/raft-large-files.txt "https://domain.com/FUZZ"

# Fuzzing de puertos locales
wfuzz -c -z range,1-65535 http://10.10.10.x/url.php?path=127.0.0.1:FUZZ

# Fuzzing de parametros
wfuzz -c --hc=404 -w Seclist/Discovery/Web Content/burp-parameter-names.txt "https://domain.com/php?FUZZ"

# Evitar falsos positivos
wfuzz -c -z range,1-65535 --hl=55  http://10.10.10.x:6000/url.php?path=127.0.0.1:FUZZ  # El parametro --hl es para indicar  que elimine los resultados con ese numero de caracteres.

# Bypass 302 Forbiden
 wfuzz -H "X-Forwarded-For: 10.10.10.10" --sc 302 -u http://192.168.x.x/FUZZ.php -w /usr/share/wordlists/wfuzz/general/big.txt

# Fuzzing de parametros dentro de una sesion
wfuzz -c -w /usr/share/seclists/Fuzzing/LFI/LFI-LFISuite-pathtotest-huge.txt -u 192.168.x.x/manage.php?file=FUZZ -b "PHPSESSID=j5umpotgqatp9d63iuk6gmsikm" | grep "passwd"

# Fuzzing SQLi - Bypass de autenticacion
 wfuzz -c --hc=400,404 -t 200 -w /opt/SecLists/Fuzzing/SQLi/quick-SQLi.txt -d "myusername=%27&mypassword=FUZZ&Submit=Login" http://192.168.x.x/checklogin.php
````

> En caso de encontrar un directorio /.git podemos dumpear su contenido con [githack](https://github.com/lijiejie/GitHack/blob/master/GitHack.py) o [gitdumper](https://github.com/arthaud/git-dumper)


### Mejores listas de fuzzing

- Directorios:
  - /dirbuster/directory-list-2.3-medium.txt
  - /dirbuster/directory-list-2.3-big.txt
  - SecLists/Discovery/Web-Content/directory-list-lowercase-2.3-big.txt
- Subdominios:
  - SecLists/Discovery/DNS/subdomains-top1million-5000.txt
- Archivos:
  - Seclist/Discovery/Web-Content/raft-large-files.txt
- Parametros:
  - Seclist/Discovery/Web Content/burp-parameter-names.txt
- Vulnerabilidades:
  - Seclists/Fuzzing/LFI/LFI-LFISuite-pathtotest-huge.txt
  - SecLists/Fuzzing/SQLi/quick-SQLi.txt
- Usuarios:
  - Seclist/usernames/xato-net-10-million-usernames.txt
  - SecLists/master/Usernames/Names/names.txt
- Servicios/Aplicaciones
  - IIS: Seclists/Discovery/Web-Content/IIS.fuzz.txt
  - FTP: SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt
  - WP: SecLists/blob/master/Discovery/Web-Content/CMS/wp-plugins.fuzz.txt



## Whatweb
````
whatweb --color=never --no-errors -a 3 -v $url 2>&1 | tee "tcp_port_protocol_whatweb.txt"
````

## CMS
### Wordpress

Principales vulnerabilidades en Wordpress:
* Version desactualizada
* Plugins vulnerables
* Enumeracion de usuarios en panel de login
* Fuerza bruta

Enumeración WP

````bash
# Enumeracion basica
wpscan -u "http://192.168.x.x"

# Especificar directorio de WP
wpscan -u "http://192.168.x.x" --wp-content-dir "directorio-wordpress"

# Enumeracion de usuarios
wpscan -u "http://192.168.x.x" --enumerate u

# Bypass de bloqueo de enumeracion de usuarios
ruby stop_user_enumeration_bypass.rb http://192.168.x.x

# Bypass otros bloqueos
wpscan -u "http://192.168.1.x" --username usuario -w /usr/share/wordlists/rockyou.txt --random-agent

# Fuerza bruta
wpscan -u "http://192.168.x.x" --username usuario -w /usr/share/wordlists/rockyou.txt

# Enumerate vulnerable plugins and themes, timthumbs, wp-config.php backups, database exports, usernames and media IDs
wpscan --url $url --no-update --disable-tls-checks -e vp,vt,tt,cb,dbe,u,m --plugins-detection aggressive --plugins-version-detection aggressive -f cli-no-color 2>&1 

# Enumerate all plugins
wpscan --url $url --disable-tls-checks --no-update -e ap --plugins-detection aggressive -f cli-no-color 2>&1

# HTTPS ignorando certificados
wpscan --url https://192.168.181.148:12380/blogblog --enumerate u --disable-tls-checks

````

> Rutas comunes: /wp-content/uploads, /wp-content/themes, /wp-content/plugins


### Drupal
- drupwn
````
python3 drupwn --version 7.28 --mode enum --target $url
````
- droopescan
````
droopescan scan drupal -u $url
````

### Joomla

````bash
# Enumeracion basica
jooscan --url www.example.com

# Enumerar componentes instalados
perl joomscan.pl --url www.example.com --enumerate-components

# Usar una cookie
perl joomscan.pl --url www.example.com --cookie "test=demo;"

# Usar un user-agent
perl joomscan.pl --url www.example.com --user-agent "Googlebot/2.1 (+http://www.googlebot.com/bot.html)"

#Usar un proxy
perl joomscan.pl --url www.example.com --proxy http://127.0.0.1:8080

````

## Nikto
````bash
Escaneo basico
nikto -h http://foo.com

Escaneo de un puerto especifico
nikto -h http://foo.com -port 8000
nikto -h http://foo.com:8000

Escaneo de vulnerabilidades SSL
nikto -h http://foo.com -ssl
````


Robots.txt
/robots.txt

Only get HTTP headers

curl -I $url

Cewl

cewl $url/index.php -m 3 --with-numbers -w cewl.txt


Shellshock

# Check if bash vulnerable to CVE-2014-6271 (bash vulnerable if ‘vulnerable’ in output)
env x='() { :;}; echo vulnerable' bash -c "echo this is a test" 

# Brute force CGI files
gobuster dir -u $url/cgi-bin/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -x "cgi,sh,pl,py" -s "200,204,301,302,307,403,500" -t 16 -o "tcp_port_protocol_gobuster_shellshock.txt"

wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/CGIs.txt --hc 404 -t 16 $url/cgi-bin/FUZZ 2>&1 | tee "tcp_port_protocol_wfuzz.txt"

Webmin uses cgi files - versions up to 1.700 vulnerable to shellshock (http://www.webmin.com/security.html)
